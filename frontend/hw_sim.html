<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI-WEBSIM : Hardware Architecture Explorer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { background-color: #0f172a; color: #e2e8f0; font-family: 'Inter', sans-serif; }
        /* 하드웨어 블록 스타일 */
        .hw-block { transition: all 0.3s ease; border: 2px solid #334155; display: flex; align-items: center; justify-content: center; font-weight: bold; text-align: center; position: relative; overflow: hidden; }
        .cpu-core { background: rgba(59, 130, 246, 0.2); border-color: #3b82f6; }
        .cache-block { background: rgba(16, 185, 129, 0.2); border-color: #10b981; }
        .memory-block { background: rgba(245, 158, 11, 0.2); border-color: #f59e0b; }
        /* 열/부하 시각화 */
        .heat-overlay { position: absolute; top:0; left:0; right:0; bottom:0; background: radial-gradient(circle, rgba(239,68,68,0.6) 0%, rgba(239,68,68,0) 70%); opacity: 0; transition: opacity 0.3s; pointer-events: none; }
        
        input[type=range] { accent-color: #3b82f6; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }
    </style>
</head>
<body class="h-screen flex flex-col overflow-hidden">

    <header class="bg-slate-900 border-b border-slate-700 p-4 flex justify-between items-center h-16 shrink-0">
        <div class="flex items-center gap-3">
            <div class="w-8 h-8 bg-purple-600 rounded flex items-center justify-center font-bold text-white">A</div>
            <h1 class="text-xl font-bold tracking-tight">AI-WEBSIM <span class="text-slate-500 text-sm font-normal ml-2">| HW Architecture Analyst</span></h1>
        </div>
        <div class="text-sm text-slate-400">
            Mode: <span class="text-purple-400 font-mono">Trade-off Analysis</span>
        </div>
    </header>

    <div class="flex flex-1 overflow-hidden">
        
        <aside class="w-80 bg-slate-800 border-r border-slate-700 p-5 flex flex-col gap-6 overflow-y-auto shrink-0">
            
            <div>
                <h2 class="font-bold text-sm text-slate-300 mb-2">Target Workload Scenario</h2>
                <select id="workload-select" class="w-full bg-slate-900 border border-slate-600 rounded px-3 py-2 text-sm focus:outline-none focus:border-purple-500">
                    <option value="compute">Compute Bound (e.g., Rendering, AI Inf)</option>
                    <option value="memory">Memory Bound (e.g., Database, Big Data)</option>
                </select>
                 <p class="text-xs text-slate-500 mt-2" id="workload-desc">CPU 클럭과 코어 수가 성능에 큰 영향을 미칩니다.</p>
            </div>

            <hr class="border-slate-700">

            <div>
                <h2 class="font-bold text-sm text-blue-400 mb-4 flex items-center gap-2">CPU Compute Complex</h2>
                
                <div class="mb-5">
                    <div class="flex justify-between mb-1">
                        <label class="text-xs font-medium">Core Count</label>
                        <span id="val-cores" class="text-xs font-mono text-white">8 Cores</span>
                    </div>
                    <input type="range" id="range-cores" min="4" max="32" step="4" value="8" class="w-full h-1 bg-slate-600 rounded-lg appearance-none cursor-pointer">
                </div>

                <div class="mb-5">
                    <div class="flex justify-between mb-1">
                        <label class="text-xs font-medium">Clock Speed (GHz)</label>
                        <span id="val-clock" class="text-xs font-mono text-white">3.0 GHz</span>
                    </div>
                    <input type="range" id="range-clock" min="2.0" max="5.0" step="0.1" value="3.0" class="w-full h-1 bg-slate-600 rounded-lg appearance-none cursor-pointer">
                     <p class="text-xs text-red-400 mt-1" id="power-warning" style="display:none;">⚠️ High power consumption expected</p>
                </div>
            </div>

            <div>
                <h2 class="font-bold text-sm text-green-400 mb-4 flex items-center gap-2">Memory Hierarchy</h2>
                
                <div class="mb-5">
                    <div class="flex justify-between mb-1">
                        <label class="text-xs font-medium">L3 Cache Size (MB)</label>
                        <span id="val-cache" class="text-xs font-mono text-white">32 MB</span>
                    </div>
                    <input type="range" id="range-cache" min="16" max="128" step="16" value="32" class="w-full h-1 bg-slate-600 rounded-lg appearance-none cursor-pointer accent-green-500">
                </div>

                <div class="mb-5">
                    <div class="flex justify-between mb-1">
                        <label class="text-xs font-medium">DRAM Bandwidth (GB/s)</label>
                        <span id="val-bw" class="text-xs font-mono text-white">200 GB/s</span>
                    </div>
                    <input type="range" id="range-bw" min="100" max="800" step="100" value="200" class="w-full h-1 bg-slate-600 rounded-lg appearance-none cursor-pointer accent-orange-500">
                </div>
            </div>
        </aside>

        <main class="flex-1 flex flex-col p-5 gap-5 overflow-hidden bg-slate-950">
            
            <div class="h-2/5 bg-slate-900 rounded-lg border border-slate-700 p-4 flex flex-col relative relative overflow-hidden">
                <h2 class="text-sm font-bold text-slate-400 mb-2 absolute top-4 left-4">Dynamic Architecture Block Diagram</h2>
                
                <div class="flex-1 flex gap-2 items-stretch justify-center pt-8 px-8 pb-2">
                    <div class="flex-1 flex flex-col gap-1" style="flex-basis: 40%;">
                        <div id="cpu-container" class="flex-1 grid grid-cols-4 gap-1 bg-slate-800 p-1 rounded border border-blue-900/50 transition-all">
                            </div>
                        <div class="text-xs text-center text-blue-400 font-mono mt-1">CPU Complex</div>
                    </div>

                    <div class="w-4 bg-slate-700 flex items-center justify-center">
                        <div class="h-full w-1 bg-slate-500 animate-pulse"></div>
                    </div>

                    <div class="flex-1 flex flex-col gap-2" style="flex-basis: 50%;">
                        <div id="l3-cache-block" class="hw-block cache-block flex-1" style="flex-grow: 1;">
                            <div class="z-10 flex flex-col">
                                <span>L3 Cache (Shared)</span>
                                <span id="viz-cache-size" class="text-xs font-mono">32MB</span>
                            </div>
                        </div>
                        <div id="memory-interface-block" class="hw-block memory-block h-16">
                            <div class="z-10 flex flex-col">
                                <span>DRAM Interface</span>
                                <span id="viz-bw-size" class="text-xs font-mono">200 GB/s</span>
                            </div>
                             <div id="bw-flow-viz" class="absolute inset-0 opacity-30 bg-[linear-gradient(90deg,transparent_0%,#f59e0b_50%,transparent_100%)] bg-[length:200%_100%] animate-[flow_2s_linear_infinite]"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="h-3/5 grid grid-cols-5 gap-5 shrink-0">
                
                <div class="col-span-2 grid grid-rows-3 gap-3">
                     <div class="bg-slate-800 p-3 rounded-lg border border-slate-700 flex flex-col justify-center relative overflow-hidden">
                        <h4 class="text-slate-400 text-xs font-semibold uppercase mb-1">Estimated Performance Score</h4>
                        <div class="flex items-baseline gap-2 z-10">
                            <span id="metric-perf" class="text-4xl font-bold text-purple-400">---</span>
                            <span class="text-xs text-slate-500">points</span>
                        </div>
                        <div class="absolute right-0 bottom-0 opacity-10 text-purple-600">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-16 h-16"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 13.5l10.5-11.25L12 10.5h8.25L9.75 21.75 12 13.5H3.75z" /></svg>
                        </div>
                    </div>

                     <div class="bg-slate-800 p-3 rounded-lg border border-slate-700 flex flex-col justify-center relative overflow-hidden">
                        <h4 class="text-slate-400 text-xs font-semibold uppercase mb-1">Estimated Unit Cost</h4>
                        <div class="flex items-baseline gap-2 z-10">
                            <span id="metric-cost" class="text-3xl font-bold text-green-400">---</span>
                            <span class="text-xs text-slate-500">USD</span>
                        </div>
                         <div class="absolute right-2 bottom-2 opacity-10 text-green-600 font-bold text-5xl">$</div>
                    </div>

                     <div class="bg-slate-800 p-3 rounded-lg border border-slate-700 flex flex-col justify-center relative overflow-hidden">
                        <h4 class="text-slate-400 text-xs font-semibold uppercase mb-1">Estimated Power (TDP)</h4>
                        <div class="flex items-baseline gap-2 z-10">
                            <span id="metric-power" class="text-3xl font-bold text-red-400">---</span>
                            <span class="text-xs text-slate-500">Watts</span>
                        </div>
                        <div class="w-full bg-slate-900 h-1.5 rounded-full mt-2 overflow-hidden">
                            <div id="bar-power" class="bg-red-500 h-full transition-all" style="width: 50%"></div>
                        </div>
                    </div>
                </div>

                <div class="col-span-1 bg-slate-800 p-3 rounded-lg border border-slate-700 flex items-center justify-center">
                     <div class="w-full h-full relative">
                         <canvas id="radarChart"></canvas>
                     </div>
                </div>

                <div class="col-span-2 bg-slate-800 p-3 rounded-lg border border-slate-700 relative">
                    <h4 class="text-slate-400 text-xs font-semibold absolute top-3 left-3">Performance vs. Cost Trade-off</h4>
                    <div class="w-full h-full pt-6">
                        <canvas id="tradeoffChart"></canvas>
                    </div>
                </div>

            </div>
        </main>
    </div>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    keyframes: {
                        flow: {
                            '0%': { backgroundPosition: '200% 0' },
                            '100%': { backgroundPosition: '-200% 0' },
                        }
                    }
                }
            }
        }
    </script>

    <script>
        // --- Simulation Model (Simplified Phenomenological Model) ---
        
        const state = {
            workload: 'compute', // or 'memory'
            cores: 8,
            clock: 3.0,
            cache: 32,
            bw: 200,
            // Calculated metrics
            perfScore: 0,
            cost: 0,
            power: 0
        };

        // 기본 상수 (비용 및 파워 계산용 임의 값)
        const BASE_COST = 50;
        const COST_PER_CORE = 15;
        const COST_PER_MB_CACHE = 1.5;
        const COST_PER_GB_BW = 0.2;

        const BASE_POWER = 30;
        // Power approx: Cores * Clock^2.5 * Factor
        
        function calculateMetrics() {
            // 1. Power Calculation (TDP approx)
            // 클럭 속도가 전력에 지수적인 영향을 줌
            let corePower = state.cores * Math.pow(state.clock, 2.8) * 0.8; 
            let uncorePower = (state.cache * 0.2) + (state.bw * 0.1);
            state.power = Math.round(BASE_POWER + corePower + uncorePower);

            // 2. Cost Calculation
            state.cost = Math.round(BASE_COST + (state.cores * COST_PER_CORE) + (state.cache * COST_PER_MB_CACHE) + (state.bw * COST_PER_GB_BW));

            // 3. Performance Calculation (Scenario based)
            let baseComputePerf = state.cores * state.clock * 100;
            
            // 메모리 병목 현상 모델링 (간단한 버전)
            // 캐시가 클수록 메모리 의존도 감소. 워크로드에 따라 요구 대역폭이 다름.
            let requiredBW = (state.workload === 'compute') ? baseComputePerf * 0.1 : baseComputePerf * 0.5;
            let cacheHitBenefit = Math.min(1, Math.sqrt(state.cache) / 15); // 수확 체감
            let effectiveBWNeeded = requiredBW * (1 - cacheHitBenefit);
            
            // 대역폭이 부족하면 성능 패널티
            let bwPenaltyFactor = 1.0;
            if (effectiveBWNeeded > state.bw) {
                // 대역폭 부족 비율만큼 성능 감소
                bwPenaltyFactor = state.bw / effectiveBWNeeded;
                // 메모리 중심 워크로드에서는 패널티가 더 큼
                if (state.workload === 'memory') bwPenaltyFactor = Math.pow(bwPenaltyFactor, 1.5);
            }

            state.perfScore = Math.round(baseComputePerf * bwPenaltyFactor);
        }


        // --- UI & Visualization Updates ---

        const cpuContainer = document.getElementById('cpu-container');
        const l3CacheBlock = document.getElementById('l3-cache-block');
        const bwFlowViz = document.getElementById('bw-flow-viz');
        
        // 차트 초기화
        const radarCtx = document.getElementById('radarChart').getContext('2d');
        const radarChart = new Chart(radarCtx, {
            type: 'radar',
            data: {
                labels: ['Performance', 'Power Efficiency', 'Cost Efficiency'],
                datasets: [{
                    label: 'Current Design',
                    data: [50, 50, 50],
                    backgroundColor: 'rgba(147, 51, 234, 0.2)',
                    borderColor: 'rgba(147, 51, 234, 1)',
                    pointBackgroundColor: 'rgba(147, 51, 234, 1)',
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: { r: { beginAtZero: true, max: 100, ticks: { display: false }, grid: { color: '#334155' } } },
                plugins: { legend: { display: false } }
            }
        });

        const tradeoffCtx = document.getElementById('tradeoffChart').getContext('2d');
        const tradeoffChart = new Chart(tradeoffCtx, {
            type: 'scatter',
            data: {
                datasets: [
                    {
                        label: 'Current Point',
                        data: [{x: 0, y: 0}],
                        backgroundColor: '#4ade80', // Green dot
                        pointRadius: 8,
                        pointHoverRadius: 10
                    },
                    {
                        // 배경에 깔아둘 가상의 데이터 포인트들 (참고용)
                        label: 'Reference Points',
                        data: [ {x: 300, y: 1500}, {x: 450, y: 3000}, {x: 600, y: 6000}, {x: 800, y: 12000}, {x: 150, y: 800} ],
                        backgroundColor: '#64748b', display: false, pointRadius: 4
                    }
                ]
            },
            options: {
                responsive: true, maintainAspectRatio: false,
                scales: {
                    x: { title: { display: true, text: 'Cost ($)', color: '#94a3b8' }, grid: { color: '#334155' }, min: 0, max: 1200 },
                    y: { title: { display: true, text: 'Performance Score', color: '#94a3b8' }, grid: { color: '#334155' }, min: 0, max: 25000 }
                },
                plugins: { legend: { display: false }, tooltip: { enabled: false } }
            }
        });


        function updateUI() {
            // 1. Update Text Labels
            document.getElementById('val-cores').innerText = state.cores + ' Cores';
            document.getElementById('val-clock').innerText = state.clock.toFixed(1) + ' GHz';
            document.getElementById('val-cache').innerText = state.cache + ' MB';
            document.getElementById('val-bw').innerText = state.bw + ' GB/s';
            document.getElementById('workload-desc').innerText = state.workload === 'compute' 
                ? "연산 중심: 높은 클럭과 코어 수가 중요하며, 캐시 효율이 상대적으로 낮습니다."
                : "메모리 중심: 큰 캐시와 높은 메모리 대역폭이 성능 병목을 해소합니다.";
            
            document.getElementById('power-warning').style.display = (state.clock > 4.0 || state.cores > 24) ? 'block' : 'none';

            // 2. Update Visual Block Diagram
            // CPU Cores
            cpuContainer.innerHTML = '';
            let cols = state.cores <= 8 ? 4 : (state.cores <= 16 ? 4 : 8); // 코어 수에 따라 그리드 조정
            cpuContainer.classList.remove('grid-cols-4', 'grid-cols-8');
            cpuContainer.classList.add(`grid-cols-${cols}`);

            // 클럭에 따른 발열 색상 강도 계산 (2.0GHz ~ 5.0GHz -> 0.0 ~ 1.0 alpha)
            const heatIntensity = (state.clock - 2.0) / 3.0;
            
            for(let i=0; i<state.cores; i++) {
                const core = document.createElement('div');
                core.className = 'hw-block cpu-core text-[10px] text-blue-200 h-full';
                core.innerText = `C${i}`;
                // Heat overlay
                const heat = document.createElement('div');
                heat.className = 'heat-overlay';
                heat.style.opacity = heatIntensity * 0.8; // 최대 80% 강도
                core.appendChild(heat);
                cpuContainer.appendChild(core);
            }

            // Cache Size Visualization (flex-grow 조절)
            // min 16MB -> grow 1, max 128MB -> grow 4 (approx)
            const cacheGrowFactor = 1 + (state.cache - 16) / 112 * 3;
            l3CacheBlock.style.flexGrow = cacheGrowFactor;
            document.getElementById('viz-cache-size').innerText = state.cache + 'MB';

            // Bandwidth Visualization (애니메이션 속도 조절)
            // 100GB/s -> 3s duration, 800GB/s -> 0.5s duration
            const animDuration = 3.5 - (state.bw / 800) * 3;
            bwFlowViz.style.animationDuration = `${animDuration}s`;
            document.getElementById('viz-bw-size').innerText = state.bw + ' GB/s';


            // 3. Update Metrics & Charts
            document.getElementById('metric-perf').innerText = state.perfScore.toLocaleString();
            document.getElementById('metric-cost').innerText = state.cost.toLocaleString();
            document.getElementById('metric-power').innerText = state.power;

            // Power bar (Max approx 800W 설정)
            const powerPercentage = Math.min(100, (state.power / 800) * 100);
            document.getElementById('bar-power').style.width = `${powerPercentage}%`;
            document.getElementById('bar-power').classList.toggle('bg-red-500', powerPercentage < 70);
            document.getElementById('bar-power').classList.toggle('bg-purple-500', powerPercentage >= 70); // 고전력 시 색상 변경

            // Radar Chart Update (정규화 필요, 대략적인 스케일링)
            const perfNorm = Math.min(100, state.perfScore / 250);
            const powerEffNorm = Math.min(100, (state.perfScore / state.power) * 2); // 점수/와트
            const costEffNorm = Math.min(100, (state.perfScore / state.cost) * 3); // 점수/달러
            
            radarChart.data.datasets[0].data = [perfNorm, powerEffNorm, costEffNorm];
            radarChart.update();

            // Scatter Chart Update
            tradeoffChart.data.datasets[0].data[0] = { x: state.cost, y: state.perfScore };
            // 축 스케일 동적 조정 (선택 사항, 여기선 고정 스케일 사용)
            tradeoffChart.update();
        }

        // Event Listeners
        document.getElementById('workload-select').addEventListener('change', (e) => { state.workload = e.target.value; calculateMetrics(); updateUI(); });
        document.getElementById('range-cores').addEventListener('input', (e) => { state.cores = parseInt(e.target.value); calculateMetrics(); updateUI(); });
        document.getElementById('range-clock').addEventListener('input', (e) => { state.clock = parseFloat(e.target.value); calculateMetrics(); updateUI(); });
        document.getElementById('range-cache').addEventListener('input', (e) => { state.cache = parseInt(e.target.value); calculateMetrics(); updateUI(); });
        document.getElementById('range-bw').addEventListener('input', (e) => { state.bw = parseInt(e.target.value); calculateMetrics(); updateUI(); });

        // Initialize
        calculateMetrics();
        updateUI();

    </script>
</body>
</html>